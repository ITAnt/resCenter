## 内存管理

### 数据存放区域

##### 查看命令

> objdump -h xxx.exe | grep bss  or \\\\.data

##### 未初始化的全局变量(.bss)段

bss 段用来存放那些没有初始化和初始化为0 的全局变量。

###### 特点

- bss 类型的全局变量只占运行时的内存空间，而不占用文件空间。
- 这些变量都有个确定的初始值
- 作为全局变量，在整个程序的运行周期内，bss 数据是一直存在的

##### 初始化过的全局变量(.data)段

data段用来存放那些初始化为非零的全局变量。如果数据全是零，为了优化考虑，编译器把它当作 bss 来处理。

###### 特点

data 类型的全局变量既占文件空间，又占用运行时的内存空间。

##### 常量数据(.rodata段)

关于rodata 类型的数据，要注意以下几点。

- 常量不一定就放在 rodata 里，有的立即数直接和指令编码在一起，存放在代码段 （.text）中
- 对于字符串常量，编译器会自动去掉重复的字符串，保证一个字符串在一个可执行文件（EXE/SO）中只存在一份复制
- rodata 是在多个进程间是共享的，这样可以提高运行空间利用率
- 在有的嵌入式系统中，rodata 放在 ROM(或者 NOR Flash)里，运行时直接读取，无须加载到RAM内存中
- 在嵌入式 Linux 系统中，也可以通过一种叫做 XIP （就地执行）的技术，也可以直接读取，而无须加载到 RAM内存中
- 常量是不能修改的，修改常量在 Linux 下会出现段错误

##### 代码(.text)段

text 段存放代码（如函数）和部分整数常量，它与 rodata 段相似。

##### 栈(stack)

栈用于存放临时变量和函数参数。

要注意的是，存放在栈中的数据只在当前函数及下一层函数中有效，一旦函数返回了，这些数据也自动释放了，继续访问这些变量会造成意想不到的错误。

##### 堆(heap)

堆是最灵活的一种内存，它的生命周期完全由使用者控制。标准的C语言提供以下几个函数：

- malloc : 用来分配一块指定大小的内存
- realloc：用来调整/重分配一块存在的内存
- free：用来释放不再使用的内存

使用堆内存请注意两个问题。

- 内存泄露

  内存分配了不释放称为内存泄露(Memory Leak)。当然释放时也只能释放分配出来的内存，释放无效的内存或者重复 free 都是不行的，会造成程序 crash。

- 内存溢出

###### 检查工具

Linux 下有 valgrind。